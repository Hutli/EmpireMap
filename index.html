<!DOCTYPE html>
<!-- saved from url=(0066)https://leafletjs.com/examples/crs-simple/crs-simple-example1.html -->
<html id="index">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		
		<title>The Empire</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!--link rel="stylesheet" type="text/css" href="css/sidenav.css"-->
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>

	   	<!-- Make sure this exists AFTER Leaflet's CSS -->
	 	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>

	   	<script src="js/jquery-3.3.1.js"></script>

		<style>
			html, body {
				height: 100%;
				margin: 0;
			}

			.info {
			    padding: 6px 8px;
			    font: 14px/16px Arial, Helvetica, sans-serif;
			    background: white;
			    background: rgba(255,255,255,0.8);
			    box-shadow: 0 0 15px rgba(0,0,0,0.2);
			    border-radius: 5px;
			}
			.info h4 {
			    margin: 0 0 5px;
			    color: #777;
			}

			/* The side navigation menu */
			.sidenav {
			    height: 100%; /* 100% Full-height */
			    width: 0; /* 0 width - change this with JavaScript */
			    position: fixed; /* Stay in place */
			    z-index: 1; /* Stay on top */
			    top: 0; /* Stay at the top */
			    left: 0;
			    background-color: #111; /* Black*/
			    overflow-x: hidden; /* Disable horizontal scroll */
			    padding-top: 60px; /* Place content 60px from the top */
			    transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
			}

			/* The navigation menu links */
			.sidenav a {
			    padding: 8px 8px 8px 32px;
			    text-decoration: none;
			    font-size: 25px;
			    color: #818181;
			    display: block;
			    transition: 0.3s;
			}

			/* When you mouse over the navigation links, change their color */
			.sidenav a:hover {
			    color: #f1f1f1;
			}

			/* Style page content - use this if you want to push the page content to the right when you open the side navigation */
			.main {
			    transition: margin-left .5s;
			    margin-left: 0;
			    /*width: 100%;*/
			    height: 100%;
			}

			/* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
			@media screen and (max-height: 450px) {
			    .sidenav {padding-top: 15px;}
			    .sidenav a {font-size: 18px;}
			} 

			.center {
			   position: absolute;
			   top: 50%;
			   left: 50%;
			   width: 20px;
			   height: 20px;
			   margin-top: -10px; /* Half the height */
			   margin-left: -10px; /* Half the width */
			}

			.leaflet-container .leaflet-control-mouseposition {
			  background-color: rgba(255, 255, 255, 0.7);
			  box-shadow: 0 0 5px #bbb;
			  padding: 0 5px;
			  margin:0;
			  color: #333;
			  font: 11px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
			}
		</style>

		
	</head>
	<body data-gr-c-s-loaded="true">
		<div id="mySidenav" class="sidenav">
		    <a href="#">The Marches</a>
		    <a href="#">Wintermark</a>
		    <hr>
		    <h2 left="20px" style="color:#818181">Tips:</h2>
			<ul style="color:#818181">
			  	<li>Hold control to open wiki</li>
			</ul>
		</div>
		<div id="map" class="main"></div>

		<script>
			var map = L.map('map', {
				minZoom: -2,
				crs: L.CRS.Simple
			});

			var isCtrlKeyPressed = false;
			var bounds = [[0,0], [4811,6428]];
			var image = L.imageOverlay('images/main.png', bounds).addTo(map);

			var nationsData = {"type":"FeatureCollection","features":[
				{
				    "type": "Feature",
				    "properties": {
				        "name": "The Marches",
				        "Armies": 4,
				        "Territories": 4,
				        "url": "https://www.profounddecisions.co.uk/empire-wiki/The_Marches",
				        "features": {"type":"FeatureCollection","features":[
					        {
							    "type": "Feature",
							    "properties": {
							        "name": "Bregasland",
							        "url": "https://www.profounddecisions.co.uk/empire-wiki/Bregasland",
							        "features": {"type":"FeatureCollection","features":[
							        	{
							        		"type": "Feature",
							        		"properties": {
							        			"name": "Rushring",
							        			"Description": "A partially submerged stone circle, the notorious site of a number of ritual killings in 365YE. It stands at the centre of one of the so-called dead meres of the Grey Fens, and both local Marchers and Feni alike give it a wide berth. Local legend claims that there are thirteen stones in the Rushring, but accounts differ wildly, in some cases claiming there are as many as thirty-nine. There are likewise many stories about what the circle represents. Some claim it is a band of Jotun orcs turned to stone by a canny landskeeper, while others claim the stones mark the site of some terrible crime or ancient magical accident, perhaps that associated with the formation of the dead meres themselves.",
							        			"url": "https://www.profounddecisions.co.uk/empire-wiki/Bregasland#Rushring",
							        		},
							        		"geometry":{
							        			"type":"Point",
							        			"coordinates": [1654,4811-2788],
							        		}
							        	}
							        ]}
							    },
							    "geometry":{"type":"Polygon","coordinates":[[
							    	[1361,4811-2425],
							    	[1763,4811-2413],
							    	[1848,4811-2545],
							    	[1995,4811-2679],
							    	[1957,4811-2791],
							    	[2031,4811-2845],
							    	[2280,4811-2922],
							    	[2092,4811-3069],
							    	[1760,4811-2963],
							    	[1657,4811-2931],
							    	[1408,4811-2750],
							    ]]}
							},
							{
							    "type": "Feature",
							    "properties": {
							        "name": "Mitwold",
							        "url": "https://www.profounddecisions.co.uk/empire-wiki/Mitwold",
							    },
							    "geometry":{"type":"Polygon","coordinates":[[
							    	[1957,4811-2791],
							    	[1995,4811-2679],
							    	[2374,4811-2661],
							    	[2404,4811-2616],
							    	[2454,4811-2586],
							    	[2497,4811-2725],
							    	[2611,4811-2775],
							    	[2620,4811-2907],
							    	[2413,4811-2992],
							    	[2280,4811-2922],
							    	[2031,4811-2845],
							    ]]}
							},
							{
							    "type": "Feature",
							    "properties": {
							        "name": "Upwold",
							        "url": "https://www.profounddecisions.co.uk/empire-wiki/Upwold",
							    },
							    "geometry":{"type":"Polygon","coordinates":[[
							    	[2454,4811-2586],
							    	[2516,4811-2540],
							    	[2982,4811-2502],
				    				[3019,4811-2890],
							    	[2952,4811-2916],
							    	[2779,4811-2863],
							    	[2620,4811-2907],
							    	[2611,4811-2775],
							    	[2497,4811-2725],
							    ]]}
							},
							{
							    "type": "Feature",
							    "properties": {
							        "name": "Mournwold",
							        "url": "https://www.profounddecisions.co.uk/empire-wiki/Mournwold",
							    },
							    "geometry":{"type":"Polygon","coordinates":[[
							    	[2092,4811-3069],
							    	[2280,4811-2922],
							    	[2413,4811-2992],
							    	[2620,4811-2907],
							    	[2779,4811-2863],
							    	[2952,4811-2916],
				    				[3019,4811-2890],
				    				[2916,4811-3063],
							    	[2806,4811-3100],
							    	[2788,4811-3221],
							    	[2755,4811-3242],
							    	[2466,4811-3199],
							    	[2416,4811-3210],
							    	[2394,4811-3187],
							    	[2248,4811-3170],
							    	[2096,4811-3068],
							    ]]}
							},
						]},
				    },
				    "geometry":{"type":"Polygon","coordinates":[[
				    	[1361,4811-2425],
				    	[1763,4811-2413],
				    	[1848,4811-2545],
				    	[1995,4811-2679],
				    	[2374,4811-2661],
				    	[2404,4811-2616],
				    	[2454,4811-2586],
				    	[2516,4811-2540],
				    	[2982,4811-2502],
				    	[3019,4811-2890],
				    	[2916,4811-3063],
				    	[2806,4811-3100],
				    	[2788,4811-3221],
				    	[2755,4811-3242],
				    	[2466,4811-3199],
				    	[2416,4811-3210],
				    	[2394,4811-3187],
				    	[2248,4811-3170],
				    	[2096,4811-3068],
				    	[1760,4811-2963],
				    	[1657,4811-2931],
				    	[1408,4811-2750],
				    ]]},
				},
				{
					"type": "Feature",
				    "properties": {
				        "name": "Wintermark",
				        "Armies": 3,
				        "Territories": 3,
				        "url": "https://www.profounddecisions.co.uk/empire-wiki/Wintermark"
				    },
				    "geometry":{"type":"Polygon","coordinates":[[
				    	[1763,4811-2413],
				    	[1848,4811-2545],
				    	[1995,4811-2679],
				    	[2374,4811-2661],
				    	[2404,4811-2616],
				    	[2516,4811-2540],
				    	[2982,4811-2502],
				    	[2990,4811-2446],
				    	[2892,4811-2328],
				    	[2903,4811-2159],
				    	[2692,4811-2071],
				    	[2678,4811-2010],
				    	[2775,4811-1952],
				    	[2764,4811-1821],
				    	[2660,4811-1779],
				    	[2676,4811-1716],
				    	[2576,4811-1672],
				    	[2628,4811-1588],
				    	[2557,4811-1395],
				    	[2757,4811-1227],
				    	[1981,4811-1161],
				    	[1552,4811-1342],
				    	[1443,4811-1665],
				    	[1407,4811-2077],
				    	[1573,4811-2224],
				    ]]}
				}
			]}

			var geojson = L.geoJson(nationsData, {
				    style: style,
				    onEachFeature: onEachFeature
				});

			function createMap(data){
				map.removeLayer(geojson);

				geojson = L.geoJson(data, {
				    style: style,
				    onEachFeature: onEachFeature
				}).addTo(map);
			}

			function style(feature) {
			    return {
			        weight: 1,
			        opacity: 1,
			        color: 'black',
			        dashArray: '3',
			        fillOpacity: 0
			    };
			}

			function highlightFeature(e) {
			    var layer = e.target;
			    if(layer.feature.geometry.type == "Polygon"){
				    layer.setStyle({
				        weight: 5,
				        color: '#666',
				        dashArray: '',
				        fillOpacity: 0.7
				    });

				    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
				        layer.bringToFront();
				    }
			}
			    info.update(layer.feature.properties);
			}

			function resetHighlight(e) {
			    geojson.resetStyle(e.target);
			    info.update();
			}

			function zoomToFeature(e) {
				if(isCtrlKeyPressed){
					window.open(e.target.feature.properties.url);
				} else {
					if(e.target.feature.geometry.type == "Polygon"){
						map.fitBounds(e.target.getBounds());
						createMap(e.target.feature.properties.features);
					} else {
						var latlng = e.target.getLatLng(); 
						map.flyTo(latlng, map.getZoom() + 1);
						setMinZoom = true;
					}
				}
				if(map.getMinZoom() != map.getZoom()){
					setMinZoom = true;					
				}
			}

			var setMinZoom = false;

			function setZoomToCurrent(e) {
				if(setMinZoom){
					map.setMinZoom(map.getZoom());
					map.setMaxBounds(map.getBounds());
					setMinZoom = false;
				}
			}

			map.on({
			    zoomend: setZoomToCurrent,
			});

			function onEachFeature(feature, layer) {
			    layer.on({
			        mouseover: highlightFeature,
			        mouseout: resetHighlight,
			        click: zoomToFeature,
			    });
			}

			var info = L.control();

			info.onAdd = function (map) {
			    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
			    this.update();
			    return this._div;
			};

			// method that we will use to update the control based on feature properties passed
			info.update = function (props) {
				var innerHTML = '<h4>Empire Nation Data</h4>'
				if(props){
					innerHTML += '<b>' + props.name + '</b>';
					for (var key in props) {
						if(key != "name" && key != "url" && key != "features"){
							innerHTML += '<br/>' + key + ': ' + props[key];
						}
			        }
		    	} else {
		    		innerHTML += 'Hover over a nation'
		    	}
			    this._div.innerHTML = innerHTML;
			};
			
			/*var resetButton = L.DomUtil.create('input');
			resetButton.type = "button";
			resetButton.title = "Reset View";
			resetButton.value = "Reset";
			resetButton.onclick  = function() {
				map.fitBounds(bounds);
			}*/

			var menuButton = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');;
			menuButton.style.backgroundColor = 'white';
			menuButton.id = "menuButton";
		    menuButton.style.width = '30px';
		    menuButton.style.height = '30px';
			menuButton.innerHTML = "<img src='images/menu.png' width='60%' class = 'center'/>";
			menuButton.onclick = function() {
				openNav();
			}

			var myCustomControl = L.Control.extend({
			 
			    options: {
			    	position: 'topleft' 
			    },
			 
				onAdd: function (map) {
			    	return menuButton;
				},
			});
			
			$(document).on("mousedown", function (e) {
			    if(e.ctrlKey){
			    	isCtrlKeyPressed = true;
			    }
			});

			$(document).on("mouseup", function (e) {
			    if(!e.ctrlKey){
			    	isCtrlKeyPressed = false;
			    }
			});

			function openNav() {
			    document.getElementById("mySidenav").style.width = "250px";
			    document.getElementById("map").style.marginLeft = "250px";
			    document.getElementById("menuButton").onclick = closeNav;
			}

			/* Set the width of the side navigation to 0 and the left margin of the page content to 0 */
			function closeNav() {
			    document.getElementById("mySidenav").style.width = "0";
			    document.getElementById("map").style.marginLeft = "0";
			    document.getElementById("menuButton").onclick = openNav;
			}

			L.Control.MousePosition = L.Control.extend({
			  options: {
			    position: 'bottomleft',
			    separator: ' : ',
			    emptyString: 'Unavailable',
			    lngFirst: false,
			    numDigits: 5,
			    lngFormatter: undefined,
			    latFormatter: undefined,
			    prefix: ""
			  },

			  onAdd: function (map) {
			    this._container = L.DomUtil.create('div', 'leaflet-control-mouseposition');
			    L.DomEvent.disableClickPropagation(this._container);
			    map.on('mousemove', this._onMouseMove, this);
			    this._container.innerHTML=this.options.emptyString;
			    return this._container;
			  },

			  onRemove: function (map) {
			    map.off('mousemove', this._onMouseMove)
			  },

			  _onMouseMove: function (e) {
			    var lng = this.options.lngFormatter ? this.options.lngFormatter(e.latlng.lng) : L.Util.formatNum(e.latlng.lng, this.options.numDigits);
			    var lat = this.options.latFormatter ? this.options.latFormatter(e.latlng.lat) : L.Util.formatNum(e.latlng.lat, this.options.numDigits);
			    var value = this.options.lngFirst ? lng + this.options.separator + lat : lat + this.options.separator + lng;
			    var prefixAndValue = this.options.prefix + ' ' + value;
			    this._container.innerHTML = prefixAndValue;
			  }

			});

			L.Map.mergeOptions({
			    positionControl: false
			});

			L.Map.addInitHook(function () {
			    if (this.options.positionControl) {
			        this.positionControl = new L.Control.MousePosition();
			        this.addControl(this.positionControl);
			    }
			});

			L.control.mousePosition = function (options) {
			    return new L.Control.MousePosition(options);
			};

			L.control.mousePosition().addTo(map);

			createMap(nationsData);

			info.addTo(map);

			map.addControl(new myCustomControl());
			map.fitBounds(bounds);
		</script>
	</body>
</html>