<!DOCTYPE html>
<!-- saved from url=(0066)https://leafletjs.com/examples/crs-simple/crs-simple-example1.html -->
<html id="index">
	<head>
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest">
		<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
		<meta name="msapplication-TileColor" content="#2b5797">
		<meta name="theme-color" content="#ffffff">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		
		<title>The Empire</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!--link rel="stylesheet" type="text/css" href="css/sidenav.css"-->
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>

	   	<!-- Make sure this exists AFTER Leaflet's CSS -->
	 	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>

	   	<script src="js/jquery-3.3.1.js"></script>

		<style>
			html, body {
				height: 100%;
				margin: 0;
			}

			.info {
			    padding: 6px 8px;
			    font: 14px/16px Arial, Helvetica, sans-serif;
			    background: white;
			    background: rgba(255,255,255,0.8);
			    box-shadow: 0 0 15px rgba(0,0,0,0.2);
			    border-radius: 5px;
			}
			.info h4 {
			    margin: 0 0 5px;
			    color: #777;
			}

			
			/*.sidenav {
			    height: 100%;
			    width: 0;
			    position: fixed;
			    z-index: 1;
			    top: 0;
			    left: 0;
			    background-color: white;
			    overflow-x: hidden;
			    padding-top: 60px;
			    transition: 0.5s;
			    box-shadow: -10px -10px 10px 1px #aaaaaa inset;
			}

			.sidenav a {
			    padding: 8px 32px 8px 32px;
			    text-decoration: none;
			    font-size: 25px;
			    color: black;
			    display: block;
			}*/

			/* The side navigation menu */
			.sidenav {
			    height: 100%; /* 100% Full-height */
			    width: 250px;
			    position: fixed;
			    left: 0;
			    background-color: white;
			    /*overflow-x: hidden; /* Disable horizontal scroll */
			    padding-top: 40px; /* Place content 60px from the top */
			    transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
			    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
			    font-family: "Montserrat", arial, sans-serif;
				min-height: 100%;
			}

			/* The navigation menu links */
			.sidenav a {
			    padding: 8px 8px 8px 32px;
			    text-decoration: none;
			    color: #818181;
			    text-transform: capitalize;
			    display: block;
			    transition: 0.3s;
			}

			/* When you mouse over the navigation links, change their color */
			.sidenav a:hover {
			    color: #f1f1f1;
			}

			.sidenav a:active {
			    color: #f1f1f1;
			}

			.sidenav h2 {
			    font-size: 30px;
			    text-align: center;
				color: #818181;
			    display: block;
			}

			.sidenav ul {
				padding-left: 32;
			    color: #818181;
			    display: block;
			}

			.sidenav hr {
				height: 5px;
				background-color: #818181;
				width: 90%;
			}

			.content {
				min-height: 100%;
				margin-bottom: -330px;
				position: relative;
			}

			.footer {
				height: 330px;
				position: relative;
			}

			/* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
			@media screen and (max-height: 450px) {
			    .sidenav {padding-top: 15px;}
			    .sidenav a {font-size: 18px;}
			}

			/* Style page content - use this if you want to push the page content to the right when you open the side navigation */
			.main {
			    transition: margin-left .5s;
			    margin-left: 0;
			    /*width: 100%;*/
			    height: 100%;
			    box-shadow: -10px 0px 10px 1px #aaaaaa;
			}

						/* The side navigation menu */
			.poiInfo {
			    height: 90%; /* 100% Full-height */
			    position: absolute; /* Stay in place */
			    z-index: 314159; /* Stay on top */
			    top: 1; /* Stay at the top */
			    background-color: white;
			    overflow-x: hidden; /* Disable horizontal scroll */
			    padding-top: 40px; /* Place content 60px from the top */
			    transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
			    box-shadow: -10px 10px 10px 1px #aaaaaa;
			}

			.poiInfo .closebtn {
			    position: absolute;
			    top: 0;
			    right: 25px;
			    font-size: 36px;
			    margin-left: 50px;
			}

			/* The navigation menu links */
			.poiInfo a {
			    padding: 8px 32px 8px 32px;
			    text-decoration: none;
			    font-size: 25px;
			    color: #818181;
			    display: block;
			}

			.poiInfo h2 {
			    font-size: 35px;
			    padding: 8px 32px 8px 32px;
				color: #818181;
			}

			.poiInfo img {
			    display: block;
			    margin-left: auto;
			    margin-right: auto;
			    max-width: 80%;
			}

			/* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
			@media screen and (max-height: 450px) {
			    .sidenav {padding-top: 15px;}
			    .sidenav a {font-size: 18px;}
			    .poiInfo {padding-top: 15px;}
			    .poiInfo a {font-size: 18px;}
			} 

			.center {
			   position: absolute;
			   top: 50%;
			   left: 50%;
			   width: 20px;
			   height: 20px;
			   margin-top: -10px; /* Half the height */
			   margin-left: -10px; /* Half the width */
			}

			.leaflet-container .leaflet-control-mouseposition {
			  background-color: rgba(255, 255, 255, 0.7);
			  box-shadow: 0 0 5px #bbb;
			  padding: 0 5px;
			  margin:0;
			  color: #333;
			  font: 11px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
			}

			.noscrol {
				overflow: hidden;
			}
		</style>

		
	</head>
	<body data-gr-c-s-loaded="true" class="noscrol">
		<div id="mySidenav" class="sidenav">
			<div class="content">
				<h2>Nations</h2>
			    <a>The Marches</a>
			    <a>Wintermark</a>
			    <a>Dawn</a>
			    <a>Highguard</a>
			    <a>The League</a>
		    </div>
		    <div class="footer">
		    <hr>
			    <h2>Tips:</h2>
				<ul>
				  	<li>Hold control to open wiki</li>
				</ul>
			</div>
		</div>

		<div id="poiInfoPanel" class="poiInfo">
		</div>

		<div id="map" class="main"></div>

		<script>
			var map = L.map('map', {
				minZoom: -2,
				crs: L.CRS.Simple
			});

			var isCtrlKeyPressed = false;
			var bounds = [[0,0], [4811,6428]];
			var image = L.imageOverlay('images/main.png', bounds).addTo(map);

			var nationsData = new L.geoJson();

			$.ajax({
				dataType: "json",
				url: "data/data.json",
				success: function(data) {
				    $(data.features).each(function(key, data) {
				        geoJson.addData(data);
				    });
				}
			});

			nationsData.style = style;
			nationsData.onEachFeature = onEachFeature;

			/*var geojson = L.geoJson(nationsData, {
			    style: style,
			    onEachFeature: onEachFeature
			});*/

			function createMap(data){
				map.removeLayer(geojson);

				geojson = L.geoJson(data, {
				    style: style,
				    onEachFeature: onEachFeature
				}).addTo(map);
			}

			function style(feature) {
			    return {
			        weight: 1,
			        opacity: 1,
			        color: 'black',
			        dashArray: '3',
			        fillOpacity: 0
			    };
			}

			function highlightFeature(e) {
			    var layer = e.target;
			    if(layer.feature.geometry.type == "Polygon"){
				    layer.setStyle({
				        weight: 5,
				        color: '#666',
				        dashArray: '',
				        fillOpacity: 0.7
				    });

				    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
				        layer.bringToFront();
				    }
			}
			    info.update(layer.feature.properties);
			}

			function resetHighlight(e) {
			    geojson.resetStyle(e.target);
			    info.update();
			}

			var isFeatureClicked = false;
			function featureClicked(e) {
				if(isCtrlKeyPressed){
					var url = e.target.feature.properties.url;
					if(url){
						window.open();
					}
				} else {
					if(e.target.feature.geometry.type == "Polygon"){
						map.fitBounds(e.target.getBounds());
						createMap(e.target.feature.properties.features);
					} else {
						var latlng = e.target.getLatLng(); 
						map.flyTo(latlng, 1);
						var innerHTML = "<a href='javascript:void(0)' class='closebtn' onclick='closePOIInfo()'>&times;</a><h2>" + e.target.feature.properties.name + "</h2><a color='white'>" + e.target.feature.properties.description + "</a><img src='images/" + e.target.feature.properties.image + "'/>"
						openPOIInfo(innerHTML);
					}
					isFeatureClicked = true;
				}
			}

			var currentLayer = 0;
			function createLayerFromZoom(e) {
				if(!isFeatureClicked){
					var newZoom = map.getZoom();
					if(newZoom == -2 && currentLayer != 0){
						createMap(nationsData);
						currentLayer = 0;
					} else if((newZoom == -1 || newZoom == 0) && currentLayer != 1){
						var regionsData = {"type": "FeatureCollection"};
						regionsData.features = new Array();
						var nationFeatures = nationsData.features;
						for (var i in nationFeatures){
							var regionFeatures = nationFeatures[i].properties.features;
							if(regionFeatures){
								Array.prototype.push.apply(regionsData.features, regionFeatures.features);
							}
						}
						createMap(regionsData);
						currentLayer = 1;
					} else if(newZoom > 0 && currentLayer != 2) {
						var poiData = {"type": "FeatureCollection"};
						poiData.features = new Array();
						var nationFeatures = nationsData.features;
						for (var i in nationFeatures){
							var regionFeatures = nationFeatures[i].properties.features;
							if(regionFeatures){
								for(var j in regionFeatures.features){
									var poiFeatures = regionFeatures.features[j].properties.features;
									if(poiFeatures){
										Array.prototype.push.apply(poiData.features, poiFeatures.features);
									}
								}
							}
						}
						createMap(poiData);
						currentLayer = 2;
					}
				}
				isFeatureClicked = false;
			}

			map.on({
			    zoomend: createLayerFromZoom,
			});

			function onEachFeature(feature, layer) {
			    layer.on({
			        mouseover: highlightFeature,
			        mouseout: resetHighlight,
			        click: featureClicked,
			    });
			}

			var info = L.control();

			info.onAdd = function (map) {
			    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
			    this.update();
			    return this._div;
			};

			// method that we will use to update the control based on feature properties passed
			info.update = function (props) {
				var innerHTML = '<h4>Empire Nation Data</h4>'
				if(props){
					innerHTML += '<b>' + props.name + '</b>';
					for (var key in props) {
						if(key != "name" && key != "url" && key != "features" && key != "image" && key != "description"){
							innerHTML += '<br/>' + key + ': ' + props[key];
						}
			        }
		    	} else {
		    		innerHTML += 'Hover over a nation'
		    	}
			    this._div.innerHTML = innerHTML;
			};
			
			/*var resetButton = L.DomUtil.create('input');
			resetButton.type = "button";
			resetButton.title = "Reset View";
			resetButton.value = "Reset";
			resetButton.onclick  = function() {
				map.fitBounds(bounds);
			}*/

			var menuButton = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');;
			menuButton.style.backgroundColor = 'white';
			menuButton.id = "menuButton";
		    menuButton.style.width = '30px';
		    menuButton.style.height = '30px';
			menuButton.innerHTML = "<img src='images/menu.png' width='60%' class = 'center'/>";
			menuButton.onclick = function() {
				openNav();
			}

			var myCustomControl = L.Control.extend({
			 
			    options: {
			    	position: 'topleft' 
			    },
			 
				onAdd: function (map) {
			    	return menuButton;
				},
			});
			
			$(document).on("mousedown", function (e) {
			    if(e.ctrlKey){
			    	isCtrlKeyPressed = true;
			    }
			});

			$(document).on("mouseup", function (e) {
			    if(!e.ctrlKey){
			    	isCtrlKeyPressed = false;
			    }
			});

			var poiInfo = document.getElementById("poiInfoPanel");
			if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
				poiInfo.style.right = "-110%";
				poiInfo.style.width = "100%";
			} else {
				poiInfo.style.right = "-50%";
				poiInfo.style.width = "40%";
			}

			function openPOIInfo(innerHTML){
				poiInfo.innerHTML = innerHTML;
				poiInfo.style.right = 0;
				//poiInfo.style.width = "40%";
			    //document.getElementById("map").style.marginRight = "40%";
			    //document.getElementById("menuButton").onclick = closeNav;
			}

			function closePOIInfo(){
				var poiInfo = document.getElementById("poiInfoPanel");
				poiInfo.innerHTML = "";
				if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
					poiInfo.style.right = "-110%";
				} else {
					poiInfo.style.right = "-50%";
				}
				//document.getElementById("map").style.marginRight = "0";
			    //document.getElementById("menuButton").onclick = closeNav;
			}

			function openNav() {
			    //document.getElementById("mySidenav").style.width = "250px";
			    document.getElementById("map").style.marginLeft = "250px";
			    document.getElementById("menuButton").onclick = closeNav;
			}

			/* Set the width of the side navigation to 0 and the left margin of the page content to 0 */
			function closeNav() {
			    //document.getElementById("mySidenav").style.width = "0";
			    document.getElementById("map").style.marginLeft = "0";
			    document.getElementById("menuButton").onclick = openNav;
			}

			L.Control.MousePosition = L.Control.extend({
			  options: {
			    position: 'bottomleft',
			    separator: ' : ',
			    emptyString: 'Unavailable',
			    lngFirst: false,
			    numDigits: 5,
			    lngFormatter: undefined,
			    latFormatter: undefined,
			    prefix: ""
			  },

			  onAdd: function (map) {
			    this._container = L.DomUtil.create('div', 'leaflet-control-mouseposition');
			    L.DomEvent.disableClickPropagation(this._container);
			    map.on('mousemove', this._onMouseMove, this);
			    this._container.innerHTML=this.options.emptyString;
			    return this._container;
			  },

			  onRemove: function (map) {
			    map.off('mousemove', this._onMouseMove)
			  },

			  _onMouseMove: function (e) {
			    var lng = this.options.lngFormatter ? this.options.lngFormatter(e.latlng.lng) : L.Util.formatNum(e.latlng.lng, this.options.numDigits);
			    var lat = this.options.latFormatter ? this.options.latFormatter(e.latlng.lat) : L.Util.formatNum(e.latlng.lat, this.options.numDigits);
			    var value = this.options.lngFirst ? lng + this.options.separator + lat : lat + this.options.separator + lng;
			    var prefixAndValue = this.options.prefix + ' ' + value;
			    this._container.innerHTML = prefixAndValue;
			  }

			});

			L.Map.mergeOptions({
			    positionControl: false
			});

			L.Map.addInitHook(function () {
			    if (this.options.positionControl) {
			        this.positionControl = new L.Control.MousePosition();
			        this.addControl(this.positionControl);
			    }
			});

			L.control.mousePosition = function (options) {
			    return new L.Control.MousePosition(options);
			};

			L.control.mousePosition().addTo(map);

			createMap(nationsData);

			info.addTo(map);

			map.addControl(new myCustomControl());
			map.fitBounds(bounds);
		</script>
	</body>
</html>